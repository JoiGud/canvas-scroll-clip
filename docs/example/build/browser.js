(()=>{var p=(r,e,t)=>new Promise((i,n)=>{var _=a=>{try{m(t.next(a))}catch(h){n(h)}},L=a=>{try{m(t.throw(a))}catch(h){n(h)}},m=a=>a.done?i(a.value):Promise.resolve(a.value).then(_,L);m((t=t.apply(r,e)).next())});var s=class extends Error{constructor(e){e||(e="Whoops! Something went wrong.");super(`${e}`);Object.setPrototypeOf(this,Object.getPrototypeOf(this)),Error.captureStackTrace&&Error.captureStackTrace(this,s)}get name(){return this.constructor.name}},v=class extends s{log(e){console.log(`${this.name}: ${e}`)}warn(e){console.warn(`${this.name}: ${e}`)}},u=class extends v{constructor(e){super(e);this.warn(e)}};var M=/\d+(?!.*\d+)/,o={viewport:{resize:"viewport.resize",scroll:"viewport.scroll"},images:{loaded:"images.loaded"}},I=Object.values(o).map(r=>Object.values(r)).flat(),c=(r,e=0)=>{let t;return(...n)=>{t&&clearTimeout(t),t=setTimeout(()=>r(...n),e)}};function H(r){return p(this,null,function*(){return new Promise((e,t)=>{let i=new Image;i.onload=()=>{e(i)},i.src=r,i.onerror=()=>{t(new s(`Image with name '...${r.slice(-20)}' was not found.`))}})})}function b(r){let e=new Array(r.count).fill(0).map((t,i)=>H($(r,i+1)));return Promise.all(e)}function l(){return window.pageYOffset||document.documentElement.scrollTop}function x(r=l()){return r/(document.documentElement.scrollHeight-window.innerHeight)||0}function $(r,e=1){return[r.path,r.image.start,e.toString().padStart(r.image.padStart,"0"),r.image.ending].join("")}function E(r){let e=r.split("/");return e.pop(),`${e.join("/")}/`}function S(r,e){let t=P(r),i=B(t),n=C(t);if(e.toString().length>n.length)throw new s("Leading zeros in first frame path has to be more than the frame count and sequence at the end.");return{start:t.slice(0,t.indexOf(n)),sequence:parseInt(n),padStart:n.length,ending:t.slice(t.indexOf(n)+n.length),extension:i}}function C(r){let e=r.match(M),t=e&&e[0]!==null?e[0]:"";if(t.length<2)throw new s('Bad image sequence format. Should start with 0 and be longer than 2 numbers, f.e. "frame_01.jpg"');return t}function B(r){let e=r.split(".").pop()||" ";if(!["jpg","jpeg","png"].includes(e))throw new s(`Image with extension ['${e}'] is not supported.`);return`.${e}`}function P(r){return r.split("/").pop()||""}var d=class{constructor({framePath:e,frameCount:t}){if(!e.length)throw new s("Frame path is not defined.");if(!t)throw new s("Frame count is not defined.");this.count=t,this.path=E(e),this.image=S(e,this.count)}};var g=class{constructor(){this.on=(e,t)=>{I.includes(e)||new u(`Event ['${e}'] is not supported.`);let i=this.observers.get(e);i?i.push(t):this.observers.set(e,[t])};this.remove=(e,t)=>{let i=this.observers.get(e);if(!!i){for(let n=0;n<i.length;n++)if(i[n]===t){i.splice(n,1);return}}};this.emit=(e,...t)=>{let i=this.observers.get(e);if(!!i)for(let n=0;n<i.length;n++)i[n](...t)};this.observers=new Map}};var y=class{constructor(){if(!window)throw new s("window is not found.");if(!document)throw new s("document is not found.");this.events=new g,this.screen=this.getScreenViewport(),this.bind()}bind(){window.addEventListener("resize",c(this.handleResize.bind(this))),window.addEventListener("scroll",c(this.handleScroll.bind(this))),this.events.on(o.viewport.resize,e=>{this.screen=e})}getScreenViewport(){var e,t;return{x:window.innerWidth||((e=document.documentElement)==null?void 0:e.clientWidth),y:window.innerHeight||((t=document.documentElement)==null?void 0:t.clientHeight)}}handleResize(){this.events.emit(o.viewport.resize,this.getScreenViewport())}handleScroll(){let e=window.pageYOffset||document.documentElement.scrollTop;this.events.emit(o.viewport.scroll,e)}},F=y;var f=class extends F{constructor(e){super();this.scrollArea=0;this.inputs=e,this.identifier=e.identifier||"csc",this.frame=new d(e),this.scrollArea=e.scrollArea||0,e.scrollArea&&typeof e.scrollArea=="string"&&(this.scrollArea=parseInt(e.scrollArea,10))}set setScrollableArea(e){this.scrollArea||(this.scrollArea=e)}};var w=class extends f{constructor(e,t){super(t);this.loading=!0;this.images=[];if(!e)throw new s("HTML element is not defined.");this._container=e,this._container.classList.add(`${this.identifier}-container`),this._container.style.setProperty("height",`${this.scrollArea}px`),this._canvas=document.createElement("canvas"),this._canvas.classList.add(`${this.identifier}-canvas`),this._wrapper=document.createElement("div"),this._wrapper.classList.add(this.identifier),this._wrapper.appendChild(this._canvas),this._container.appendChild(this._wrapper),this.context=this._canvas.getContext("2d"),this.viewport={width:this.screen.x,height:this.screen.y,top:0,bottom:this.screen.y},this.events.on(o.viewport.scroll,i=>{this.loading||this.drawImageByScrollTop(i)}),this.preload()}preload(){return p(this,null,function*(){return yield b(this.frame).then(e=>{var t,i;this.images=e,this.viewport={width:(t=this.images[0])==null?void 0:t.width,height:(i=this.images[0])==null?void 0:i.height,top:this._container.getBoundingClientRect().top+l()||0,bottom:this._container.getBoundingClientRect().bottom+l()||0},this._canvas.width=this.viewport.width,this._canvas.height=this.viewport.height,this.setScrollableArea=this.viewport.height*2,this._container.style.setProperty("height",`${this.scrollArea}px`),this.drawImageByScrollTop(),this._container.classList.add(`${this.identifier}--loaded`),this.loading=!1,this.events.emit(o.images.loaded)})})}drawImage(e){this.context.drawImage(e,0,0,this.viewport.width,this.viewport.height)}drawImageByFrameNumber(e=0){this.drawImage(this.images[e])}drawImageByScrollTop(e){let t=x(e),i;i=Math.min(this.frame.count-1,Math.ceil(t*this.frame.count)),i<=0&&(i=0),this.drawImageByFrameNumber(i)}};var T=class extends w{constructor(e,t,i){super(e,t);this.callback=i||(()=>{}),this.init()}init(){this.events.on(o.images.loaded,()=>{c(this.callback())})}},A=T;window.csc=A;})();
